<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Data Package Views Proposal | Frictionless Data</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
    <link rel="mask-icon" color="#000000" href="/img/safari-pinned-tab.svg">
    <link rel="manifest" href="/img/site.webmanifest">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900&amp;display=swap">
    <link rel="stylesheet" href="/fonts/index.css">
    <script src="https://plausible.io/js/script.js" data-domain="frictionlessdata.io"></script>
    <script src="https://unpkg.com/honeycomb-grid@3.1.3"></script>
    <script src="https://unpkg.com/svg.js@2.7.1"></script>
    <link rel="alternate" type="application/rss+xml" href="https://frictionlessdata.io/rss.xml" title="Frictionless Data RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://frictionlessdata.io/feed.atom" title="Frictionless Data Atom Feed">
    <link rel="alternate" type="application/json" href="https://frictionlessdata.io/feed.json" title="Frictionless Data JSON Feed">
    <meta name="description" content="Producers and consumers of data want to have their data presented in tables and graphs -- "views" on the data. This outlines a proposal on a Frictionless approach this including a spec and tooling.">
    <meta property="og:image" content="https://docs.google.com/drawings/d/1M_6Vcal4PPSHpuKpzJQGvRUbPb5yeaAdRHomIIbfnlY/pub?w=790&h=1402">
    <meta property="og:image:type">
    <meta property="og:image:width">
    <meta property="og:image:height">
    <meta property="og:image:alt">
    <meta name="twitter:image" content="https://docs.google.com/drawings/d/1M_6Vcal4PPSHpuKpzJQGvRUbPb5yeaAdRHomIIbfnlY/pub?w=790&h=1402">
    <meta itemprop="image" content="https://docs.google.com/drawings/d/1M_6Vcal4PPSHpuKpzJQGvRUbPb5yeaAdRHomIIbfnlY/pub?w=790&h=1402">
    <meta property="og:description" content="Producers and consumers of data want to have their data presented in tables and graphs -- "views" on the data. This outlines a proposal on a Frictionless approach this including a spec and tooling.">
    <meta name="twitter:description" content="Producers and consumers of data want to have their data presented in tables and graphs -- "views" on the data. This outlines a proposal on a Frictionless approach this including a spec and tooling.">
    <meta itemprop="description" content="Producers and consumers of data want to have their data presented in tables and graphs -- "views" on the data. This outlines a proposal on a Frictionless approach this including a spec and tooling.">
    <meta property="og:url" content="/blog/2017-03-31-data-package-views-proposal/">
    <meta name="twitter:url" content="/blog/2017-03-31-data-package-views-proposal/">
    <meta property="og:title" content="Data Package Views Proposal">
    <meta name="twitter:title" content="Data Package Views Proposal">
    <meta itemprop="name" content="Data Package Views Proposal">
    <meta property="og:type" content="article">
    <meta name="twitter:card" content="summary">
    <meta property="og:site_name" content="Frictionless Data">
    <link rel="preload" href="/assets/css/0.styles.82f86bd4.css" as="style"><link rel="preload" href="/assets/js/app.a2902b81.js" as="script"><link rel="preload" href="/assets/js/3.5fa550ec.js" as="script"><link rel="preload" href="/assets/js/2.17b1c5c9.js" as="script"><link rel="preload" href="/assets/js/65.071f1fe3.js" as="script"><link rel="prefetch" href="/assets/js/10.f7c1e786.js"><link rel="prefetch" href="/assets/js/100.f3be7755.js"><link rel="prefetch" href="/assets/js/101.7e1d6df4.js"><link rel="prefetch" href="/assets/js/102.0e0446fa.js"><link rel="prefetch" href="/assets/js/103.3bcdbc40.js"><link rel="prefetch" href="/assets/js/104.fe7e63b7.js"><link rel="prefetch" href="/assets/js/105.394d3853.js"><link rel="prefetch" href="/assets/js/106.b974b400.js"><link rel="prefetch" href="/assets/js/107.224beb5f.js"><link rel="prefetch" href="/assets/js/108.38ad65f8.js"><link rel="prefetch" href="/assets/js/109.d3f9e9d9.js"><link rel="prefetch" href="/assets/js/11.cfbbc0e4.js"><link rel="prefetch" href="/assets/js/110.a47179af.js"><link rel="prefetch" href="/assets/js/111.21dd805b.js"><link rel="prefetch" href="/assets/js/112.d1d4b6fc.js"><link rel="prefetch" href="/assets/js/113.2e34c2f6.js"><link rel="prefetch" href="/assets/js/114.78ae2f39.js"><link rel="prefetch" href="/assets/js/115.24c7eaf7.js"><link rel="prefetch" href="/assets/js/116.85bdea59.js"><link rel="prefetch" href="/assets/js/117.85164eb1.js"><link rel="prefetch" href="/assets/js/118.dfd2fa17.js"><link rel="prefetch" href="/assets/js/119.2c4ebfcb.js"><link rel="prefetch" href="/assets/js/12.d9fb47fc.js"><link rel="prefetch" href="/assets/js/120.9ab4a56a.js"><link rel="prefetch" href="/assets/js/121.1bb95626.js"><link rel="prefetch" href="/assets/js/122.a52b442f.js"><link rel="prefetch" href="/assets/js/123.3cc6b810.js"><link rel="prefetch" href="/assets/js/124.4132dc2c.js"><link rel="prefetch" href="/assets/js/125.ac9d6293.js"><link rel="prefetch" href="/assets/js/126.88c9378d.js"><link rel="prefetch" href="/assets/js/127.5ff67dd0.js"><link rel="prefetch" href="/assets/js/128.8b277324.js"><link rel="prefetch" href="/assets/js/129.130b6b7a.js"><link rel="prefetch" href="/assets/js/13.ab9d3f3d.js"><link rel="prefetch" href="/assets/js/130.7f175013.js"><link rel="prefetch" href="/assets/js/131.46e9f4e2.js"><link rel="prefetch" href="/assets/js/132.be369adc.js"><link rel="prefetch" href="/assets/js/133.c345b419.js"><link rel="prefetch" href="/assets/js/134.20dc089c.js"><link rel="prefetch" href="/assets/js/135.7f2aa5bc.js"><link rel="prefetch" href="/assets/js/136.46fb5468.js"><link rel="prefetch" href="/assets/js/137.9900e0e5.js"><link rel="prefetch" href="/assets/js/138.850d2795.js"><link rel="prefetch" href="/assets/js/139.84c711bf.js"><link rel="prefetch" href="/assets/js/14.0962b179.js"><link rel="prefetch" href="/assets/js/140.08503e80.js"><link rel="prefetch" href="/assets/js/141.b4624c5c.js"><link rel="prefetch" href="/assets/js/142.b178ea6a.js"><link rel="prefetch" href="/assets/js/143.8f069550.js"><link rel="prefetch" href="/assets/js/144.b22aad7a.js"><link rel="prefetch" href="/assets/js/145.60921a8f.js"><link rel="prefetch" href="/assets/js/146.35d328f6.js"><link rel="prefetch" href="/assets/js/147.8f111805.js"><link rel="prefetch" href="/assets/js/148.e091719e.js"><link rel="prefetch" href="/assets/js/149.457cfdc1.js"><link rel="prefetch" href="/assets/js/15.c5a64268.js"><link rel="prefetch" href="/assets/js/150.39300daf.js"><link rel="prefetch" href="/assets/js/151.6dc937ef.js"><link rel="prefetch" href="/assets/js/152.ff415a3b.js"><link rel="prefetch" href="/assets/js/153.7798ed7e.js"><link rel="prefetch" href="/assets/js/154.4f5652f9.js"><link rel="prefetch" href="/assets/js/155.bfba67f5.js"><link rel="prefetch" href="/assets/js/156.8334f792.js"><link rel="prefetch" href="/assets/js/157.ea1df658.js"><link rel="prefetch" href="/assets/js/158.c499164d.js"><link rel="prefetch" href="/assets/js/159.135211ae.js"><link rel="prefetch" href="/assets/js/16.b332d969.js"><link rel="prefetch" href="/assets/js/160.d8d1d6b5.js"><link rel="prefetch" href="/assets/js/161.37b24ce2.js"><link rel="prefetch" href="/assets/js/162.9db603ef.js"><link rel="prefetch" href="/assets/js/163.3a81f092.js"><link rel="prefetch" href="/assets/js/164.23b20340.js"><link rel="prefetch" href="/assets/js/165.8327b1ad.js"><link rel="prefetch" href="/assets/js/166.97b54b92.js"><link rel="prefetch" href="/assets/js/167.bbe687fa.js"><link rel="prefetch" href="/assets/js/168.38350f41.js"><link rel="prefetch" href="/assets/js/169.e06ca116.js"><link rel="prefetch" href="/assets/js/17.4ba1c84a.js"><link rel="prefetch" href="/assets/js/170.8724c2c6.js"><link rel="prefetch" href="/assets/js/171.7ebd8a93.js"><link rel="prefetch" href="/assets/js/172.edf8b83c.js"><link rel="prefetch" href="/assets/js/173.560957ed.js"><link rel="prefetch" href="/assets/js/174.a383a588.js"><link rel="prefetch" href="/assets/js/175.b7a38070.js"><link rel="prefetch" href="/assets/js/176.ad6847db.js"><link rel="prefetch" href="/assets/js/177.76c81c00.js"><link rel="prefetch" href="/assets/js/178.84bba6c4.js"><link rel="prefetch" href="/assets/js/179.77c4feba.js"><link rel="prefetch" href="/assets/js/18.d28fc2eb.js"><link rel="prefetch" href="/assets/js/180.fc91eaf8.js"><link rel="prefetch" href="/assets/js/181.d12a6b2d.js"><link rel="prefetch" href="/assets/js/182.95e258c9.js"><link rel="prefetch" href="/assets/js/183.4f0bb929.js"><link rel="prefetch" href="/assets/js/184.2db18145.js"><link rel="prefetch" href="/assets/js/185.63e237a8.js"><link rel="prefetch" href="/assets/js/186.a43d5ac2.js"><link rel="prefetch" href="/assets/js/187.c303e15d.js"><link rel="prefetch" href="/assets/js/188.bed32f20.js"><link rel="prefetch" href="/assets/js/189.397daceb.js"><link rel="prefetch" href="/assets/js/19.28d80010.js"><link rel="prefetch" href="/assets/js/190.1c1c3089.js"><link rel="prefetch" href="/assets/js/20.a5fbf886.js"><link rel="prefetch" href="/assets/js/21.14c093bc.js"><link rel="prefetch" href="/assets/js/22.7697693e.js"><link rel="prefetch" href="/assets/js/23.895e9b8a.js"><link rel="prefetch" href="/assets/js/24.c46f7101.js"><link rel="prefetch" href="/assets/js/25.f083e122.js"><link rel="prefetch" href="/assets/js/26.d7d007a4.js"><link rel="prefetch" href="/assets/js/27.19730b80.js"><link rel="prefetch" href="/assets/js/28.0332fb91.js"><link rel="prefetch" href="/assets/js/29.891c2af1.js"><link rel="prefetch" href="/assets/js/30.9904f2ad.js"><link rel="prefetch" href="/assets/js/31.1461b66d.js"><link rel="prefetch" href="/assets/js/32.f44acdea.js"><link rel="prefetch" href="/assets/js/33.a90e9bbd.js"><link rel="prefetch" href="/assets/js/34.7fe9cce9.js"><link rel="prefetch" href="/assets/js/35.8381e3cb.js"><link rel="prefetch" href="/assets/js/36.4e0bd9e6.js"><link rel="prefetch" href="/assets/js/37.f28f2173.js"><link rel="prefetch" href="/assets/js/38.60d749aa.js"><link rel="prefetch" href="/assets/js/39.d4c8ac6e.js"><link rel="prefetch" href="/assets/js/4.86253916.js"><link rel="prefetch" href="/assets/js/40.3b6084c5.js"><link rel="prefetch" href="/assets/js/41.00d298c5.js"><link rel="prefetch" href="/assets/js/42.a92b5803.js"><link rel="prefetch" href="/assets/js/43.25b56a56.js"><link rel="prefetch" href="/assets/js/44.7e6af297.js"><link rel="prefetch" href="/assets/js/45.18c8dc64.js"><link rel="prefetch" href="/assets/js/46.b7a06152.js"><link rel="prefetch" href="/assets/js/47.852889fe.js"><link rel="prefetch" href="/assets/js/48.8ca4767a.js"><link rel="prefetch" href="/assets/js/49.39f15b94.js"><link rel="prefetch" href="/assets/js/5.79072a51.js"><link rel="prefetch" href="/assets/js/50.6eaad3c7.js"><link rel="prefetch" href="/assets/js/51.e7f7bca2.js"><link rel="prefetch" href="/assets/js/52.76a34651.js"><link rel="prefetch" href="/assets/js/53.202bb7e3.js"><link rel="prefetch" href="/assets/js/54.9e9cbb98.js"><link rel="prefetch" href="/assets/js/55.cb71dcd1.js"><link rel="prefetch" href="/assets/js/56.65e1e767.js"><link rel="prefetch" href="/assets/js/57.84990213.js"><link rel="prefetch" href="/assets/js/58.2b3bd3bf.js"><link rel="prefetch" href="/assets/js/59.3359464c.js"><link rel="prefetch" href="/assets/js/6.c19d05ab.js"><link rel="prefetch" href="/assets/js/60.385842bd.js"><link rel="prefetch" href="/assets/js/61.28801f31.js"><link rel="prefetch" href="/assets/js/62.fce6cd54.js"><link rel="prefetch" href="/assets/js/63.a8712733.js"><link rel="prefetch" href="/assets/js/64.c108e977.js"><link rel="prefetch" href="/assets/js/66.a6ffa49d.js"><link rel="prefetch" href="/assets/js/67.c668ed43.js"><link rel="prefetch" href="/assets/js/68.4cf46b70.js"><link rel="prefetch" href="/assets/js/69.dab71250.js"><link rel="prefetch" href="/assets/js/7.340e27ee.js"><link rel="prefetch" href="/assets/js/70.4383c25b.js"><link rel="prefetch" href="/assets/js/71.89c94dae.js"><link rel="prefetch" href="/assets/js/72.c80b57c7.js"><link rel="prefetch" href="/assets/js/73.bff5f5c0.js"><link rel="prefetch" href="/assets/js/74.8e270b59.js"><link rel="prefetch" href="/assets/js/75.ec5d7d14.js"><link rel="prefetch" href="/assets/js/76.8a93fa60.js"><link rel="prefetch" href="/assets/js/77.ad0bf117.js"><link rel="prefetch" href="/assets/js/78.cb9a2564.js"><link rel="prefetch" href="/assets/js/79.df9ef6ef.js"><link rel="prefetch" href="/assets/js/8.51c3d6d9.js"><link rel="prefetch" href="/assets/js/80.fe41b3f3.js"><link rel="prefetch" href="/assets/js/81.f80c9b50.js"><link rel="prefetch" href="/assets/js/82.ea0e1c19.js"><link rel="prefetch" href="/assets/js/83.a8768035.js"><link rel="prefetch" href="/assets/js/84.298b8538.js"><link rel="prefetch" href="/assets/js/85.0abba798.js"><link rel="prefetch" href="/assets/js/86.8b13068a.js"><link rel="prefetch" href="/assets/js/87.142f6345.js"><link rel="prefetch" href="/assets/js/88.151550eb.js"><link rel="prefetch" href="/assets/js/89.757a6bde.js"><link rel="prefetch" href="/assets/js/9.93dac641.js"><link rel="prefetch" href="/assets/js/90.31aed2cc.js"><link rel="prefetch" href="/assets/js/91.260e264e.js"><link rel="prefetch" href="/assets/js/92.04d2ff06.js"><link rel="prefetch" href="/assets/js/93.f0fa6979.js"><link rel="prefetch" href="/assets/js/94.3a1b2358.js"><link rel="prefetch" href="/assets/js/95.27d7db14.js"><link rel="prefetch" href="/assets/js/96.a5f239a4.js"><link rel="prefetch" href="/assets/js/97.6b145136.js"><link rel="prefetch" href="/assets/js/98.5b94f72f.js"><link rel="prefetch" href="/assets/js/99.27adfc5c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.82f86bd4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="banner w-full bg-yellow"><div class="theme-container Post"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/frictionless-full-logo-blackfont.svg" alt="Frictionless Data" class="logo"> <span class="site-name can-hide">Frictionless Data</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/introduction/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/universe/" class="nav-link">
  Universe
</a></div><div class="nav-item"><a href="/adoption/" class="nav-link">
  Adoption
</a></div><div class="nav-item"><a href="/people/" class="nav-link">
  People
</a></div><div class="nav-item"><a href="https://fellows.frictionlessdata.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Fellows
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Development Menu" class="dropdown-title"><span class="title">Development</span> <span class="arrow down"></span></button> <button type="button" aria-label="Development Menu" class="mobile-dropdown-title"><span class="title">Development</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/development/architecture/" class="nav-link">
  Architecture
</a></li><li class="dropdown-item"><!----> <a href="/development/roadmap/" class="nav-link">
  Roadmap
</a></li><li class="dropdown-item"><!----> <a href="/development/process/" class="nav-link">
  Process
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Work With Us Menu" class="dropdown-title"><span class="title">Work With Us</span> <span class="arrow down"></span></button> <button type="button" aria-label="Work With Us Menu" class="mobile-dropdown-title"><span class="title">Work With Us</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/work-with-us/get-help/" class="nav-link">
  Get Help
</a></li><li class="dropdown-item"><!----> <a href="/work-with-us/contribute/" class="nav-link">
  Contribute
</a></li><li class="dropdown-item"><!----> <a href="/work-with-us/code-of-conduct/" class="nav-link">
  Code of Conduct
</a></li><li class="dropdown-item"><!----> <a href="/work-with-us/events/" class="nav-link">
  Events Calendar
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/frictionlessdata/project/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Forum
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://join.slack.com/t/frictionlessdata/shared_invite/zt-17kpbffnm-tRfDW_wJgOw8tJVLvZTrBg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat (Slack)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://matrix.to/#/#frictionlessdata:matrix.okfn.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat (Matrix)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div> <!----></nav> <div class="search-box md:pl-4"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="https://matrix.to/#/#frictionlessdata:matrix.okfn.org" title="Matrix" target="blank" class="navbaricon"><img src="/img/home/matrix.svg" class="px-2 w-5 pt-4"></a> <a href="https://join.slack.com/t/frictionlessdata/shared_invite/zt-17kpbffnm-tRfDW_wJgOw8tJVLvZTrBg" title="Slack" target="blank" class="navbaricon"><img src="/img/home/slack-icon.png" class="px-2 w-5 pt-4"></a> <a href="https://twitter.com/frictionlessd8a" title="Twitter" target="blank" class="navbaricon"><img src="/img/home/twitter-icon.svg" class="px-2 w-5 pt-4"></a> <a href="https://github.com/frictionlessdata" title="GitHub" target="blank" class="navbaricon"><img src="/img/home/github-icon.svg" class="px-2 w-5 pt-4"></a></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/introduction/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/universe/" class="nav-link">
  Universe
</a></div><div class="nav-item"><a href="/adoption/" class="nav-link">
  Adoption
</a></div><div class="nav-item"><a href="/people/" class="nav-link">
  People
</a></div><div class="nav-item"><a href="https://fellows.frictionlessdata.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Fellows
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Development Menu" class="dropdown-title"><span class="title">Development</span> <span class="arrow down"></span></button> <button type="button" aria-label="Development Menu" class="mobile-dropdown-title"><span class="title">Development</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/development/architecture/" class="nav-link">
  Architecture
</a></li><li class="dropdown-item"><!----> <a href="/development/roadmap/" class="nav-link">
  Roadmap
</a></li><li class="dropdown-item"><!----> <a href="/development/process/" class="nav-link">
  Process
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Work With Us Menu" class="dropdown-title"><span class="title">Work With Us</span> <span class="arrow down"></span></button> <button type="button" aria-label="Work With Us Menu" class="mobile-dropdown-title"><span class="title">Work With Us</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/work-with-us/get-help/" class="nav-link">
  Get Help
</a></li><li class="dropdown-item"><!----> <a href="/work-with-us/contribute/" class="nav-link">
  Contribute
</a></li><li class="dropdown-item"><!----> <a href="/work-with-us/code-of-conduct/" class="nav-link">
  Code of Conduct
</a></li><li class="dropdown-item"><!----> <a href="/work-with-us/events/" class="nav-link">
  Events Calendar
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/frictionlessdata/project/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Forum
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://join.slack.com/t/frictionlessdata/shared_invite/zt-17kpbffnm-tRfDW_wJgOw8tJVLvZTrBg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat (Slack)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://matrix.to/#/#frictionlessdata:matrix.okfn.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat (Matrix)
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Data Package Views Proposal</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2017/03/31/data-package-views-proposal/#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#motivation" class="sidebar-link">Motivation</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#desired-features" class="sidebar-link">Desired Features</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#concepts-and-background" class="sidebar-link">Concepts and Background</a></li></ul></li><li><a href="/blog/2017/03/31/data-package-views-proposal/#the-tool-chain" class="sidebar-link">The Tool Chain</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#graphs" class="sidebar-link">Graphs</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#geo-support" class="sidebar-link">Geo support</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#table-support" class="sidebar-link">Table support</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#summary" class="sidebar-link">Summary</a></li></ul></li><li><a href="/blog/2017/03/31/data-package-views-proposal/#data-package-views-specification" class="sidebar-link">Data Package Views Specification</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#data-source-spec" class="sidebar-link">Data Source Spec</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#graph-spec" class="sidebar-link">Graph Spec</a></li></ul></li><li><a href="/blog/2017/03/31/data-package-views-proposal/#appendix-simple-views-faq" class="sidebar-link">Appendix: Simple Views - FAQ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/2017/03/31/data-package-views-proposal/#appendix-recline-views" class="sidebar-link">Appendix - Recline Views</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#type-attribute" class="sidebar-link">&quot;type&quot; attribute</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#state-attribute" class="sidebar-link">&quot;state&quot; attribute</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#example-of-the-views-attribute" class="sidebar-link">Example of the views attribute:</a></li></ul></li><li><a href="/blog/2017/03/31/data-package-views-proposal/#appendix-analysis-of-vis-libraries-data-objects" class="sidebar-link">Appendix: Analysis of Vis libraries data objects</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#vega" class="sidebar-link">Vega</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#vega-lite" class="sidebar-link">Vega-Lite</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#plotly" class="sidebar-link">Plotly</a></li></ul></li><li><a href="/blog/2017/03/31/data-package-views-proposal/#appendix-plotly-graph-spec-research" class="sidebar-link">Appendix: Plotly Graph spec research</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/2017/03/31/data-package-views-proposal/#appendix-data-transform-research" class="sidebar-link">Appendix: Data Transform Research</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#plotly-transforms" class="sidebar-link">Plotly Transforms</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#vega-transforms" class="sidebar-link">Vega Transforms</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#dp-pipelines-transforms" class="sidebar-link">DP Pipelines transforms</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#vega-dataflow-usage-for-dp-views" class="sidebar-link">Vega Dataflow usage for DP views</a></li><li class="sidebar-sub-header"><a href="/blog/2017/03/31/data-package-views-proposal/#suggestion-on-usage-from-datapackage-json" class="sidebar-link">Suggestion on usage from datapackage.json</a></li></ul></li><li><a href="/blog/2017/03/31/data-package-views-proposal/#appendix-sql-transforms" class="sidebar-link">Appendix: SQL Transforms</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main aria-labelledby="main-title" class="page"><div class="theme-default-content"><header><h1 style="margin-top: -8px">Data Package Views Proposal</h1> <!----> <time class="italic"> March 31, 2017 by Rufus Pollock </time> <div class="pt-4 text-blue-500 pb-6"><img src="/img/tag.png" alt="Price icons created by Pixel perfect - Flaticon" class="w-4 h-4 inline text-lg"> <a href="/tag/specs/" class="pl-2">
    specs
  </a><a href="/tag/views/" class="pl-2">
    views
  </a></div></header> <div class="content__default"><p><strong>Update: Sep 2017: the core views proposal is now an official spec <a href="https://specs.frictionlessdata.io/views/https://specs.frictionlessdata.io/views/" target="_blank" rel="noopener noreferrer">https://specs.frictionlessdata.io/views/https://specs.frictionlessdata.io/views/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <h3 id="motivation"><a href="#motivation" class="header-anchor">#</a> Motivation</h3> <p>Producers and consumers of data [packages] want to have their data presented in tables and graphs – “views” on the data.</p> <p><em>Why? For a range of reasons – from simple eyeballing to drawing out key insights.</em></p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> LR
  data<span class="token text string">[Your Data]</span> <span class="token arrow operator">--&gt;</span> table<span class="token text string">[Table]</span>
  data <span class="token arrow operator">--&gt;</span> grap<span class="token text string">[Graph]</span>
  <span class="token keyword">classDef</span> implemented <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>lightblue<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#333<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>4px</span><span class="token punctuation">;</span>
  <span class="token keyword">class</span> data implemented<span class="token punctuation">;</span>
</code></pre></div><p>To achieve this we need to provide:</p> <ul><li>A tool-chain to create these views from the data.</li> <li>A descriptive language for specifying views such as tables, graphs, map.</li></ul> <p>These requirements are addressed through the introduction of Data Package “Views” and associated tooling.</p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> LR
  <span class="token keyword">subgraph</span> Data Package
    resource<span class="token text string">[Resource]</span>
    view<span class="token text string">[View]</span>
    resource <span class="token arrow operator">-.-&gt;</span> view
  <span class="token keyword">end</span>
  view <span class="token arrow operator">--&gt;</span> toolchain
  toolchain <span class="token arrow operator">--&gt;</span> svg<span class="token text string">[&quot;Rendered Graph (SVG)&quot;]</span>
  toolchain <span class="token arrow operator">--&gt;</span> table<span class="token text string">[Table]</span>
</code></pre></div><p>We take a “running code” approach – as in the rest of the Frictionless Data effort. We develop the spec by building a working implementation, and iterate around the spec as we develop. As development progresses the spec crystallizes and becomes ever less subject to change.</p> <p>Our current implementation efforts focus on provide javascript tools and building a data package registry (DPR).</p> <h3 id="desired-features"><a href="#desired-features" class="header-anchor">#</a> Desired Features</h3> <ul><li>Specify views such as graphs and tables as part of a data package
<ul><li>=&gt; views should be describable in a specification serializable as JSON</li></ul></li> <li>Simple things are simple: adding a bar chart or line chart is fast and easy – seconds to do and requiring minimal knowledge</li> <li>Powerful and extensible: complex and powerful graphing is also powerful</li> <li>Reuse: leverage the power of existing specs like <a href="http://vega.github.io/" target="_blank" rel="noopener noreferrer">Vega<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (and tools like Vega and Plotly)</li> <li>Composable: the views spec should be independent but composable with the other data package specs (and even usable on its own)</li></ul> <h3 id="concepts-and-background"><a href="#concepts-and-background" class="header-anchor">#</a> Concepts and Background</h3> <p><em>In progress – not quite finished</em></p> <p>To generate visualizations you usually want the following 3 types of information:</p> <ul><li>metadata: e.g. title of graph, credits etc</li> <li>graph: description / specification of the graph itself</li> <li>data: specification of data sources for the graph including location and key metadata like types</li></ul> <p>The data spec itself often consists of three distinct parts:</p> <ul><li>“raw / graph data”: a spec / description of data exactly in the form needed by the visualization system. This is often a very well defined spec e.g. an array of series …</li> <li>locate/describe: a spec of where to get data from e.g. <code>url</code> or <code>data</code> attribute plus some information on that data such as format and types.</li> <li>transform: a spec of how transform external data prior to use e.g. pivoting or filtering it</li></ul> <p>From this description it should be clear that the latter two data specs – locate/describe and transform – are actually generic and independent of the specific graphing library. The only thing the graphing library really needs is a clear description of the “raw” format which it directly consumes. Thus, we can consider a natural grouping of specs as:</p> <ul><li>general-metadata - e.g. title of graph, credits etc [provided by e.g. Data Package / define yourself!]</li> <li>data: sourcing and transform [provided by e.g. Data Resource]
<ul><li>sourcing: how to source data from external sources</li> <li>transform: how to transform data e.g. pivot it, select one field, scale a field etc</li></ul></li> <li>graph description / specification [provided by e.g. Vega]
<ul><li>graph data (raw): data as directly consumed by graph spec (usually JSON based if we are talking about JS web-based visualization)</li></ul></li></ul> <p>However, in many visualization tools – including specs like Vega – these items are combined together. This is understandable as these tools seek to offer users a “complete solution”. However, <strong>decoupling these parts and having clearly defined interfaces would offer significant benefits</strong>:</p> <ul><li>Extensability: it would be easier to extend and adapt the system. For example, adding new data import options could be done without changing the graph system.</li> <li>Composability: we can combine different parts together in different ways. For example, data import and transformation could be used for generating data for tabular display as well as graphing.</li> <li>Reusability: we want to reuse existing tools and specifications wherever possible. If we keep the specs relatively separate we can reuse the best spec for each job.</li> <li>Reliability: when the system is decoupled it is easier to test and check.</li></ul> <p>In summary, a smaller pieces, loosely joined makes it easier to adapt and evolve the specs and the associated tooling.</p> <h2 id="the-tool-chain"><a href="#the-tool-chain" class="header-anchor">#</a> The Tool Chain</h2> <p><em>We describe the tool chain first – following Frictionless Data practice of “running code”. The tool chain is what turns source data + a graph description into a rendered graph.</em></p> <p>:::info<br>
NOTE: In v1 described here there is no transform support as yet.<br>
:::</p> <p><em><strong>Figure 1: From Data Package View Spec to Rendered output</strong></em></p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> TD
  pre<span class="token text string">[Pre-cursor views e.g. Recline]</span> <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span><span class="token label property">bespoke conversions</span><span class="token arrow operator">--&gt;</span></span> dpv<span class="token text string">[Data Package Views]</span>
  dpv <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span><span class="token label property">&quot;normalize (correct any variations and ensure key fields are present)&quot;</span><span class="token arrow operator">--&gt;</span></span> dpvn<span class="token text string">[&quot;Data Package Views&lt;br /&gt;(Normalized)&quot;]</span>
  dpvn <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span><span class="token label property">&quot;compile in resource &amp; data ([future] do transforms)&quot;</span><span class="token arrow operator">--&gt;</span></span> dpvnd<span class="token text string">[&quot;Self-Contained View&lt;br /&gt;(All data and schema inline)&quot;]</span>
  dpvnd <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span><span class="token label property">compile to native spec</span><span class="token arrow operator">--&gt;</span></span> plotly<span class="token text string">[Plotly Spec]</span>
  dpvnd <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span><span class="token label property">compile to native spec</span><span class="token arrow operator">--&gt;</span></span> vega<span class="token text string">[Vega Spec]</span>
  plotly <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span><span class="token label property">render</span><span class="token arrow operator">--&gt;</span></span> html<span class="token text string">[svg/png/etc]</span>
  vega <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span><span class="token label property">render</span><span class="token arrow operator">--&gt;</span></span> html
</code></pre></div><p>:::info<br> <strong>IMPORTANT</strong>: an important “convention” we adopt for the “compiling-in” of data is that resource data should be inlined into an <code>_values</code> attribute. If the data is tabular this attribute should be an array of <em>arrays</em> (not objects).<br>
:::</p> <h3 id="graphs"><a href="#graphs" class="header-anchor">#</a> Graphs</h3> <p><em><strong>Figure 2: Conversion paths</strong></em></p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> LR
  inplotly<span class="token text string">[&quot;Plotly DP Spec&quot;]</span> <span class="token arrow operator">--&gt;</span> plotly<span class="token text string">[Plotly JSON]</span>
  simple<span class="token text string">[Simple Spec]</span> <span class="token arrow operator">--&gt;</span> plotly
  simple .<span class="token arrow operator">-&gt;</span> vega<span class="token text string">[Vega JSON]</span>
  invega<span class="token text string">[Vega DP Spec]</span> <span class="token arrow operator">--&gt;</span> vega
  vegalite<span class="token text string">[Vega Lite DP Spec]</span> <span class="token arrow operator">--&gt;</span> vega
  recline<span class="token text string">[Recline]</span> .<span class="token arrow operator">-&gt;</span> simple
  plotly <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span><span class="token label property">plotly lib</span><span class="token arrow operator">--&gt;</span></span> svg<span class="token text string">[SVG / PNG]</span>
  vega <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span><span class="token label property">vega lib</span><span class="token arrow operator">--&gt;</span></span> svg
  <span class="token keyword">classDef</span> implemented <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>lightblue<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#333<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>4px</span><span class="token punctuation">;</span>
  <span class="token keyword">class</span> recline,simple,plotly,svg implemented<span class="token punctuation">;</span>
</code></pre></div><p>Notes:</p> <ul><li>Implemented paths are shown in lightblue.</li> <li>Left-most column (Recline): pre-specs that we can convert to our standard specs</li> <li>Second-from-left column: DP View spec types.</li> <li>Second-from-right column: the graphing libraries we can use (which all output to SVG)</li></ul> <h3 id="geo-support"><a href="#geo-support" class="header-anchor">#</a> Geo support</h3> <p>:::info<br> <strong>Note</strong>: support for customizing map is limited to JS atm - there is no real map “spec” in JSON yet beyond the trivial version.</p> <p><strong>Note</strong>: vega has some geo support but geo here means full geojson style mapping.<br>
:::</p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> LR
  geo<span class="token text string">[Geo Resource]</span> <span class="token arrow operator">--&gt;</span> map
  map<span class="token text string">[Map Spec]</span> <span class="token arrow operator">--&gt;</span> leaflet<span class="token text string">[Leaflet]</span>
  <span class="token keyword">classDef</span> implemented <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>lightblue<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#333<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>4px</span><span class="token punctuation">;</span>
  <span class="token keyword">class</span> geo,map,leaflet implemented<span class="token punctuation">;</span>
</code></pre></div><h3 id="table-support"><a href="#table-support" class="header-anchor">#</a> Table support</h3> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> LR
  resource<span class="token text string">[Tabular Resource]</span> <span class="token arrow operator">--&gt;</span> table
  table<span class="token text string">[Table Spec]</span> <span class="token arrow operator">--&gt;</span> handsontable<span class="token text string">[HandsOnTable]</span>
  table <span class="token arrow operator">--&gt;</span> html<span class="token text string">[Simple HTML Table]</span>
  <span class="token keyword">classDef</span> implemented <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>lightblue<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#333<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>4px</span><span class="token punctuation">;</span>
  <span class="token keyword">class</span> resource,table,handsontable implemented<span class="token punctuation">;</span>
</code></pre></div><h3 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h3> <p><em><strong>Figure 3: From Data Package View to Rendered output flow (richer version of diagram 1)</strong></em></p> <img src="https://docs.google.com/drawings/d/1M_6Vcal4PPSHpuKpzJQGvRUbPb5yeaAdRHomIIbfnlY/pub?w=790&amp;h=1402"> <hr> <h2 id="data-package-views-specification"><a href="#data-package-views-specification" class="header-anchor">#</a> Data Package Views Specification</h2> <p><em>This is the formal specification</em></p> <p>Data Package Views (“Views”) define data views such as graphs or tables based on the data in a Data Package.</p> <blockquote><p>TODO: could they exist independently of a data package? Yes!</p></blockquote> <p>Views are defined in the <code>views</code> property of the Data Package descriptor.</p> <p><code>views</code> MUST be an array. Each entry in the array MUST be an object. This object MUST follow the Data Package View specification set out here.</p> <p>A View MUST have the following form:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token comment">// generic metadata - very similar to Data Resource or Data Package</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span>   <span class="token comment">// unique identifier for view within list of views. (should we call it id ?)</span>
  <span class="token string-property property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;My view&quot;</span> <span class="token comment">// title for this graph</span>
  <span class="token operator">...</span>
  <span class="token comment">// data sources for this spec</span>
  <span class="token string-property property">&quot;resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> resource1<span class="token punctuation">,</span> resource2 <span class="token punctuation">]</span>  
  <span class="token string-property property">&quot;specType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token comment">// one of simple | plotly | vega</span>
  <span class="token comment">// graph spec</span>
  <span class="token string-property property">&quot;spec&quot;</span><span class="token operator">:</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="data-source-spec"><a href="#data-source-spec" class="header-anchor">#</a> Data Source Spec</h3> <p>The data source spec is as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>resources: [ resourceObjOrId, resourceObjOrId ]
</code></pre></div><p>That is: an array where each entry is either:</p> <ul><li>A number - indicating the resource index in the resource array of the parent Data Package</li> <li>A string - indicating the name of the resource in the resource array of the parent Data Package</li> <li>An Object: being a full Data Resource object</li></ul> <p>:::info<br>
The resources is termed “compiled” if all resources are objects and all data on those resources has been inlined onto an attribute named <code>_values</code>. At this point, the view is entirely self-contained – all resources and their associated data is “inside” the view object and no external data loading is required.<br>
:::</p> <h3 id="graph-spec"><a href="#graph-spec" class="header-anchor">#</a> Graph Spec</h3> <h4 id="simple-graph-spec"><a href="#simple-graph-spec" class="header-anchor">#</a> Simple Graph Spec</h4> <p>The simple graph spec provides a very simple graph descriptor setup that aims for an 80/20 result. It supports only the following graph types:</p> <ul><li>Line <code>line</code> (single and multiple). Especially time series</li> <li>Bar <code>bar</code> - Especially time series</li> <li>(?) Pie <code>pie</code> – we are considering excluding pie charts as they are not widely used, often poor information design</li> <li>(?) Stacked bar</li></ul> <div class="language- extra-class"><pre class="language-text"><code>// example data
| x | y | z |
-------------
| 1 | 8 | 5 |
-------------
| 2 | 9 | 7 |
-------------
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;line&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;group&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;series&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;z&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="table-spec"><a href="#table-spec" class="header-anchor">#</a> Table Spec</h4> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;name&quot;: &quot;table-1&quot;,
  &quot;resources&quot;: [&quot;resource-1&quot;]
  &quot;specType&quot;: &quot;table&quot;
}
</code></pre></div><h4 id="vega-spec"><a href="#vega-spec" class="header-anchor">#</a> Vega Spec</h4> <p><em>We are using vega as an input: raw vega plus a few tweaks to support data input out of line from their spec (e.g. resources)</em></p> <p>This is straight-up Vega. The only modification that we leave out data references (where we need to know a table name we can rely on the names in the resources array).</p> <p>This example is just copied from <a href="http://vega.github.io/vega-editor/?mode=vega&amp;spec=bar" target="_blank" rel="noopener noreferrer">http://vega.github.io/vega-editor/?mode=vega&amp;spec=bar<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;padding&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;top&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;left&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;bottom&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;right&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// NOTE: data property is MISSING here!</span>
  <span class="token string-property property">&quot;scales&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ordinal&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token string">&quot;width&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;domain&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;table&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;linear&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;domain&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;table&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;nice&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;axes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;marks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rect&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;table&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;enter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;band&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;offset&quot;</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;y2&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;update&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;fill&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;steelblue&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;hover&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;fill&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To understand how this fits together with the overall spec here’s the full view – note how the data and graph spec are separated:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;My amazing bar chart&quot;</span>
  <span class="token string-property property">&quot;resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;table&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">55</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">43</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">91</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">81</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">53</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">87</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>  <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">52</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">48</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">49</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">87</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">66</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">68</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">49</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;specType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vega&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;spec&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;padding&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;top&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;left&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;bottom&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;right&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;scales&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ordinal&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token string">&quot;width&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;domain&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;table&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;linear&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;domain&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;table&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;nice&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;axes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span><span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span><span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;marks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rect&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;table&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;enter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;band&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;offset&quot;</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;y2&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;update&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;fill&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;steelblue&quot;</span><span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;hover&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;fill&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="vega-support-status-31-mar-2017"><a href="#vega-support-status-31-mar-2017" class="header-anchor">#</a> Vega support status 31 Mar 2017</h4> <blockquote><p>We have implemented Vega graph spec support, but there are some limitations that are described below.</p></blockquote> <h5 id="support-for-vega-spec-that-does-not-have-data-transform-e-g"><a href="#support-for-vega-spec-that-does-not-have-data-transform-e-g" class="header-anchor">#</a> Support for Vega spec that does not have data transform, e.g.:</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
  <span class="token property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;drive&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/driving.csv&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><p>can be used in a Data Package as following:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;some dp&quot;</span><span class="token punctuation">,</span>
  ...
  <span class="token property">&quot;resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>...<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;views&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demo-dp&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demo dp&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//or can be avoided as it refers to the first resource</span>
      <span class="token property">&quot;specType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vega&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;spec&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
        <span class="token property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
        <span class="token comment">// NOTE no data property in here</span>
        ...
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>so information about dataset is moved to “resources” attribute of the Datapackage and looks like following:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;drive&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/driving.csv&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;schema&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;side&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ...
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h5 id="multiple-resources-per-a-view"><a href="#multiple-resources-per-a-view" class="header-anchor">#</a> Multiple resources per a view</h5> <p>If there are no data transforms, Vega spec with multiple datasets are also supported, e.g. <a href="https://staging.datapackaged.com/anuveyatsu/lifelines" target="_blank" rel="noopener noreferrer">https://staging.datapackaged.com/anuveyatsu/lifelines<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
  <span class="token property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;people&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/people.csv&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;events&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;parse&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;when&quot;</span><span class="token operator">:</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> &quot;data/events.csv
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><h4 id="vega-lite-spec"><a href="#vega-lite-spec" class="header-anchor">#</a> Vega-lite spec</h4> <p>Identical to Vega approach</p> <h4 id="plotly-spec"><a href="#plotly-spec" class="header-anchor">#</a> Plotly spec</h4> <p>Identical to vega approach</p> <hr> <h2 id="appendix-simple-views-faq"><a href="#appendix-simple-views-faq" class="header-anchor">#</a> Appendix: Simple Views - FAQ</h2> <p>Why not vega-lite?</p> <ul><li>vega-lite multiple lines approach is a bit weird and counter-intuitive. This matters as this is very common.</li> <li>overall vega-lite retains too much complexity.</li></ul> <p>Why not this alternative series notation:</p> <div class="language- extra-class"><pre class="language-text"><code>  series: [[&quot;x&quot;, &quot;y&quot;], [&quot;x&quot;, &quot;z&quot;]]
</code></pre></div><ul><li>pros: explicit about the series …</li> <li>pros: you can plot two different series with different x values (as long as they have some commonality … )</li> <li>cons: more verbose.</li> <li>cons: 2nd multiple x values point is actually confusing for most users … (?)</li></ul> <p>Simplicity is crucial here so those cons outweight the pros.</p> <p>The following assumes the data has been provided in standard table form - with relevant naming for tables if multiple tables.</p> <h4 id="vega-lite-simple-example"><a href="#vega-lite-simple-example" class="header-anchor">#</a> vega-lite simple example</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;mark&quot;</span><span class="token operator">:</span> <span class="token string">&quot;line&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;encoding&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Date&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;temporal&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VIXClose&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;quantitative&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>What we don’t like: having to tell it explicitly what the types are - can we infer that?</li></ul> <h2 id="appendix-recline-views"><a href="#appendix-recline-views" class="header-anchor">#</a> Appendix - Recline Views</h2> <p>To specify a Recline view, it must have <code>type</code> and <code>state</code> attributes.</p> <h3 id="type-attribute"><a href="#type-attribute" class="header-anchor">#</a> <code>&quot;type&quot;</code> attribute</h3> <blockquote><p>We used to use this attribute to identify what graph type we need: plotyl or vega-lite. I suppose it should be used for something else. Right now, if <code>&quot;type&quot;</code> attribute  is set to <code>vega-lite</code>, we render vega-lite chart. In all other cases we render plotly chart.</p></blockquote> <h3 id="state-attribute"><a href="#state-attribute" class="header-anchor">#</a> <code>&quot;state&quot;</code> attribute</h3> <p><code>&quot;state&quot;</code> attribute must be an object and have <code>&quot;graphType&quot;</code>, <code>&quot;group&quot;</code> and <code>&quot;series&quot;</code> attributes.</p> <p><code>&quot;graphType&quot;</code> indicates type of the chart - line chart, bar chart, etc. Value must be a string.</p> <p><code>&quot;group&quot;</code> is used to specify base axis - right now it is used as abscissa. It must be a string that is usually a primary key in a resource.</p> <p><code>&quot;series&quot;</code> is used to specify ordinate - it must be an array of string elements. Each element represents a field name.</p> <h3 id="example-of-the-views-attribute"><a href="#example-of-the-views-attribute" class="header-anchor">#</a> Example of the <code>views</code> attribute:</h3> <div class="language- extra-class"><pre class="language-text"><code>&quot;views&quot;: [
    {
      &quot;type&quot;: &quot;Graph&quot;,
      &quot;state&quot;: {
        &quot;graphType&quot;: &quot;lines&quot;,
        &quot;group&quot;: &quot;date&quot;,
        &quot;series&quot;: [ &quot;autumn&quot; ]
      }
    }
  ]
</code></pre></div><h2 id="appendix-analysis-of-vis-libraries-data-objects"><a href="#appendix-analysis-of-vis-libraries-data-objects" class="header-anchor">#</a> Appendix: Analysis of Vis libraries data objects</h2> <p>Focus on “inline” data structure - i.e. data structure in memory.</p> <p>Motivation for this: need to generate this data structure.</p> <h3 id="vega"><a href="#vega" class="header-anchor">#</a> Vega</h3> <p>See: <a href="https://github.com/vega/vega/wiki/Data#examples" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega/wiki/Data#examples<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Data structure is standard “array of objects”:</p> <div class="language- extra-class"><pre class="language-text"><code>[
  {&quot;x&quot;:0, &quot;y&quot;:3},
  {&quot;x&quot;:1, &quot;y&quot;:5}
]
# note in Vega docs it is put as ...
[{&quot;x&quot;:0, &quot;y&quot;:3}, {&quot;x&quot;:1, &quot;y&quot;:5}]
</code></pre></div><p>Also supports simple array of values <code>[1,2,3]</code> which is implicitly mapped to:</p> <div class="language- extra-class"><pre class="language-text"><code>[
  { &quot;data&quot;: 1 },
  { &quot;data&quot;: 2 },
  { &quot;data&quot;: 3 }
]
</code></pre></div><p>Note that internally vega adds <code>_id</code> to all rows as a unique identifier (cf pandas).</p> <div class="language- extra-class"><pre class="language-text"><code># this input
[{&quot;x&quot;:0, &quot;y&quot;:3}, {&quot;x&quot;:1, &quot;y&quot;:5}]
# internally becomes
[{&quot;_id&quot;:0, &quot;x&quot;:0, &quot;y&quot;:3}, {&quot;_id&quot;:1, &quot;x&quot;:1, &quot;y&quot;:5}]
</code></pre></div><p>You can also add a <code>name</code> attribute to name the data table and then the data is put in <code>values</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;name&quot;: &quot;table&quot;,
  &quot;values&quot;: [12, 23, 47, 6, 52, 19]
}
</code></pre></div><p>Finally, inside the overall vega spec you put the data inside a <code>data</code> property:</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;width&quot;: 400,
  &quot;height&quot;: 200,
  &quot;padding&quot;: {&quot;top&quot;: 10, &quot;left&quot;: 30, &quot;bottom&quot;: 30, &quot;right&quot;: 10},
  &quot;data&quot;: [
    {
      &quot;name&quot;: &quot;table&quot;,
      &quot;values&quot;: [
        {&quot;x&quot;: 1,  &quot;y&quot;: 28}, {&quot;x&quot;: 2,  &quot;y&quot;: 55},
				...
</code></pre></div><p>See <a href="https://vega.github.io/vega-editor/?mode=vega" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega-editor/?mode=vega<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="remote-data"><a href="#remote-data" class="header-anchor">#</a> Remote Data</h4> <p>Looks like a lot like Resource. Assume that data is mapped to inline structure</p> <h3 id="vega-lite"><a href="#vega-lite" class="header-anchor">#</a> Vega-Lite</h3> <p><a href="https://vega.github.io/vega-lite/docs/data.html" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega-lite/docs/data.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Same as Vega except that:</p> <ul><li><code>data</code> is an object not an array – only one data source allowed
<ul><li>Will be given the name <code>source</code> when converting to Vega</li></ul></li> <li>Only one property allowed: <code>values</code> <ul><li>And for remote data: <code>url</code> and <code>format</code></li></ul></li></ul> <h3 id="plotly"><a href="#plotly" class="header-anchor">#</a> Plotly</h3> <p><a href="http://help.plot.ly/json-chart-schema/" target="_blank" rel="noopener noreferrer">http://help.plot.ly/json-chart-schema/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://plot.ly/javascript/reference/" target="_blank" rel="noopener noreferrer">https://plot.ly/javascript/reference/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>The Plotly model does not separate the data out quite as cleanly as vega does. The structure for Plotly json specs is as follows:</p> <ul><li>Oriented around “series”</li> <li>Each series includes its data <strong>plus</strong> the spec for the graph
<ul><li>The data is stored in two attributes <code>x</code> and <code>y</code></li></ul></li> <li>Separate <code>layout</code> property giving overall layout (e.g. margins, titles etc)</li></ul> <p>To give a sense of how it works this is the JS for creating a Plotly graph:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Plotly<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span><span class="token string">'graphDiv'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> layout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h4> <p>From <a href="http://help.plot.ly/json-chart-schema/" target="_blank" rel="noopener noreferrer">http://help.plot.ly/json-chart-schema/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and links therein:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
	<span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
				<span class="token string">&quot;giraffes&quot;</span><span class="token punctuation">,</span> 
				<span class="token string">&quot;orangutans&quot;</span><span class="token punctuation">,</span> 
				<span class="token string">&quot;monkeys&quot;</span>
			<span class="token punctuation">]</span><span class="token punctuation">,</span> 
			<span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
				<span class="token number">20</span><span class="token punctuation">,</span> 
				<span class="token number">14</span><span class="token punctuation">,</span> 
				<span class="token number">23</span>
			<span class="token punctuation">]</span><span class="token punctuation">,</span> 
			<span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SF Zoo&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;marker&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgba(55, 128, 191, 0.6)&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgba(55, 128, 191, 1.0)&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;giraffes&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;orangutans&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;monkeys&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token number">14</span><span class="token punctuation">,</span>
      <span class="token number">23</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;orientation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;h&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;uid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a4a45d&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LA Zoo&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;marker&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgba(255, 153, 51, 0.6)&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgba(255, 153, 51, 1.0)&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;giraffes&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;orangutans&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;monkeys&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token number">12</span><span class="token punctuation">,</span>
      <span class="token number">18</span><span class="token punctuation">,</span>
      <span class="token number">29</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;orientation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;h&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;uid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;d912bc&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="appendix-plotly-graph-spec-research"><a href="#appendix-plotly-graph-spec-research" class="header-anchor">#</a> Appendix: Plotly Graph spec research</h2> <p>We would like users to be able to use Plotly JSON chart schema in their Data Package Views specs so they can take full advantage of Plotly’s capabilities.</p> <p>Here’s an example - <a href="https://plot.ly/~Dreamshot/8259/" target="_blank" rel="noopener noreferrer">https://plot.ly/~Dreamshot/8259/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Col2&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;uid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babced&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;fillcolor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgb(224, 102, 102)&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;17087182&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;29354370&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;38760373&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;40912332&quot;</span><span class="token punctuation">,</span> 
            <span class="token punctuation">]</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;2000-01-01&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;2001-01-01&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;2002-01-01&quot;</span><span class="token punctuation">,</span> 
                <span class="token string">&quot;2003-01-01&quot;</span><span class="token punctuation">,</span> 
            <span class="token punctuation">]</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;fill&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tonexty&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;scatter&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token property">&quot;layout&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;autosize&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;yaxis&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token number">0</span><span class="token punctuation">,</span> 
                <span class="token number">1124750578.9473684</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;linear&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;autorange&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Total Number of Websites&quot;</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span> 
        <span class="token property">&quot;xaxis&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;tickformat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;%Y&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;showgrid&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token number">946702800000</span><span class="token punctuation">,</span> 
                <span class="token number">1451624400000</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;autorange&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>So, the major requirement will be link the plotly data structure with an external data resources in the Data Package View.</p> <p><strong>Key point:  Plotly data is of form:</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token operator">...</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
      <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">z</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token comment">// optional</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We just need a way to bind these …</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token comment">// by convention this must match the resource - if that is not possible use resource</span>
      <span class="token literal-property property">resource</span><span class="token operator">:</span> <span class="token operator">...</span><span class="token punctuation">.</span> <span class="token comment">// only if name cannot match resource</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token string">&quot;field name ...&quot;</span>  <span class="token comment">// if this is a string not an array then look it up in the resource ...</span>
      <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token string">&quot;field name ...&quot;</span>
      <span class="token literal-property property">z</span><span class="token operator">:</span> <span class="token string">&quot;field name ...&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>Using this approach we would support most of Basic, Statistical and 3D charts of Plotly library. We would not support pie chart (labels, values), maps …</em></p> <p>:::info<br> <strong>Data manipulations – not supported</strong></p> <p>In some examples of Plotly there are manipulations (e.g. filtering) on the raw data. As this is done in Javascript outside of Plotly JSON language we would not be able to support this.<br>
:::</p> <p>In the <code>plotlyToPlotly</code> function:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">plotlyToPlotly</span><span class="token punctuation">(</span><span class="token parameter">view</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> plotlySpec <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> view<span class="token punctuation">.</span>spec<span class="token punctuation">)</span>
  <span class="token keyword">for</span> trace <span class="token keyword">in</span> plotlySpec<span class="token punctuation">.</span>data <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>trace<span class="token punctuation">.</span>resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> resource <span class="token operator">=</span> <span class="token function">findResourceByNameOrIndex</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> trace<span class="token punctuation">.</span>resource<span class="token punctuation">)</span>
      <span class="token keyword">const</span> rowsAsObjects <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">const</span> rows <span class="token operator">=</span> <span class="token function">getResourceCachedValues</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> rowsAsObjects<span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>trace<span class="token punctuation">.</span>xField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        trace<span class="token punctuation">.</span>x <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">row</span> <span class="token operator">=&gt;</span> row<span class="token punctuation">[</span>trace<span class="token punctuation">.</span>xField<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">delete</span> trace<span class="token punctuation">.</span>xField
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>trace<span class="token punctuation">.</span>yField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        trace<span class="token punctuation">.</span>y <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">row</span> <span class="token operator">=&gt;</span> row<span class="token punctuation">[</span>trace<span class="token punctuation">.</span>yField<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">delete</span> trace<span class="token punctuation">.</span>yField
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>trace<span class="token punctuation">.</span>zField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        trace<span class="token punctuation">.</span>z <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">row</span> <span class="token operator">=&gt;</span> row<span class="token punctuation">[</span>trace<span class="token punctuation">.</span>zField<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">delete</span> trace<span class="token punctuation">.</span>zField
      <span class="token punctuation">}</span>
      <span class="token keyword">delete</span> trace<span class="token punctuation">.</span>resource      
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> plotlySpec
<span class="token punctuation">}</span>
</code></pre></div><h2 id="appendix-data-transform-research"><a href="#appendix-data-transform-research" class="header-anchor">#</a> Appendix: Data Transform Research</h2> <h3 id="plotly-transforms"><a href="#plotly-transforms" class="header-anchor">#</a> Plotly Transforms</h3> <p>No libraries for data transform have been found.</p> <h3 id="vega-transforms"><a href="#vega-transforms" class="header-anchor">#</a> Vega Transforms</h3> <p><a href="https://github.com/vega/vega/wiki/Data-Transforms" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega/wiki/Data-Transforms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - v2</p> <p><a href="https://vega.github.io/vega/docs/transforms/" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega/docs/transforms/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> - v3</p> <p>Vega provided Data Transforms can be used to manipulate datasets before rendering a visualisation. E.g., one may need to perform transformations such as aggregation or filtering (there many types, see link above) of a dataset and display the graph only after that. Another situation would be creating a new dataset by applying various calculations on an old one.</p> <p>Usually transforms are defined in <code>transform</code> array inside <code>data</code> property.</p> <p>“Transforms that do not filter or generate new data objects can be used within the transform array of a mark definition to specify post-encoding transforms.”</p> <p>Examples:</p> <h4 id="filtering"><a href="#filtering" class="header-anchor">#</a> Filtering</h4> <p><a href="https://vega.github.io/vega-editor/?mode=vega&amp;spec=parallel_coords" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega-editor/?mode=vega&amp;spec=parallel_coords<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This example filters rows that have both <code>Horsepower</code> and <code>Miles_per_Gallon</code> fields.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
 <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cars&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/cars.json&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datum.Horsepower &amp;&amp; datum.Miles_per_Gallon&quot;</span>
        <span class="token punctuation">}</span>  
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span> 
<span class="token punctuation">}</span>
</code></pre></div><h4 id="geopath-aggregate-lookup-filter-sort-voronoi-and-linkpath"><a href="#geopath-aggregate-lookup-filter-sort-voronoi-and-linkpath" class="header-anchor">#</a> Geopath, aggregate, lookup, filter, sort, voronoi and linkpath</h4> <p><a href="https://vega.github.io/vega-editor/?mode=vega&amp;spec=airports" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega-editor/?mode=vega&amp;spec=airports<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>This example has a lot of transforms - in some cases there is only transform applied to a dataset, in other cases there are sequence of transforms.</p> <p>In the first dataset, it applies <code>geopath</code> transform which maps GeoJSON features to SVG path strings. It uses <code>alberUsa</code> projection type (<a href="https://vega.github.io/vega/docs/projections/" target="_blank" rel="noopener noreferrer">more about projection<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p> <p>In the second dataset, it applies sum operation on “count” field and outputs it as “flights” fields.</p> <p>In the third dataset:</p> <ol><li>it compares its “iata” field against “origin” field of “traffic” dataset. Matching values are outputed as “traffic” field.</li> <li>Next, it filters out all values that are null.</li> <li>After that, it applies <code>geo</code> transform as in the first dataset above.</li> <li>Next, it filters out layout_x and layout_y values that are null.</li> <li>Then, it sorts dataset by traffic.flights field in descending order.</li> <li>After that, it applies <code>voronoi</code> transform to compute voronoi diagram based on “layout_x” and “layout_y” fields.</li></ol> <p>In the last dataset:</p> <ol><li>First, it filters values on which there is a signal called “hover” (specified in the Vega spec’s “signals” property) with “iata” attribute that matches to the dataset’s “origin” field.</li> <li>Next, it looks up matching values of “airports” dataset’s “iata” field against its “origin” and “destination” fields. Output fields are saved as “_source” and “_target”.</li> <li>Filters “_source” and “_target” values that are truthy (not null).</li> <li>Finally, linkpath transform creates visual links between nodes (<a href="https://vega.github.io/vega/docs/transforms/linkpath/" target="_blank" rel="noopener noreferrer">more about linkpath<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;states&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/us-10m.json&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;topojson&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;feature&quot;</span><span class="token operator">:</span> <span class="token string">&quot;states&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;geopath&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;projection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;albersUsa&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token number">1200</span><span class="token punctuation">,</span> <span class="token property">&quot;translate&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">450</span><span class="token punctuation">,</span> <span class="token number">280</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;traffic&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/flights-airport.csv&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;csv&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;parse&quot;</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;aggregate&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;groupby&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;origin&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">&quot;summarize&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;ops&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sum&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">&quot;as&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;flights&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;airports&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/airports.csv&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;csv&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;parse&quot;</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lookup&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;on&quot;</span><span class="token operator">:</span> <span class="token string">&quot;traffic&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;onKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;origin&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;keys&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;iata&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">&quot;as&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;traffic&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datum.traffic != null&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;geo&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;projection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;albersUsa&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;scale&quot;</span><span class="token operator">:</span> <span class="token number">1200</span><span class="token punctuation">,</span> <span class="token property">&quot;translate&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">450</span><span class="token punctuation">,</span> <span class="token number">280</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token property">&quot;lon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;longitude&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;lat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;latitude&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datum.layout_x != null &amp;&amp; datum.layout_y != null&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sort&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;by&quot;</span><span class="token operator">:</span> <span class="token string">&quot;-traffic.flights&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;voronoi&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;x&quot;</span><span class="token operator">:</span> <span class="token string">&quot;layout_x&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;y&quot;</span><span class="token operator">:</span> <span class="token string">&quot;layout_y&quot;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;routes&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data/flights-airport.csv&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;csv&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;parse&quot;</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;transform&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hover &amp;&amp; hover.iata == datum.origin&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lookup&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;on&quot;</span><span class="token operator">:</span> <span class="token string">&quot;airports&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;onKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;iata&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;keys&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;destination&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">&quot;as&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;_source&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_target&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;filter&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;datum._source &amp;&amp; datum._target&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;linkpath&quot;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="further-research-on-vega-transforms"><a href="#further-research-on-vega-transforms" class="header-anchor">#</a> Further research on Vega transforms</h4> <p><a href="https://github.com/vega/vega-dataflow-examples/" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-dataflow-examples/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>It is quite difficult to me to read the code as there is not enough documentation. I have included here the simplest example:</p> <p><code>vega-dataflow.js</code> contains Dataflow, all transforms and vega’s utilities.</p> <div class="language-htmlmixed extra-class"><pre class="language-text"><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Dataflow CountPattern&lt;/title&gt;
    &lt;script src=&quot;../../build/vega-dataflow.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
      body { margin: 10px; font-family: Helvetica Neue, Arial; font-size: 14px; }
      textarea { width: 800px; height: 200px; }
      pre { font-family: Monaco; font-size: 10px; }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;textarea id=&quot;text&quot;&gt;&lt;/textarea&gt;&lt;br/&gt;
    &lt;input id=&quot;slider&quot; type=&quot;range&quot; min=&quot;2&quot; max=&quot;10&quot; value=&quot;4&quot;/&gt;
    Frequency Threshold&lt;br/&gt;
    &lt;pre id=&quot;output&quot;&gt;&lt;/pre&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p><code>df</code> is a Dataflow instance where we register (.add) functions and parameters - as below on line 36-38. The same with adding transforms - lines 40-44. We can pass different parameters to the transforms depending on requirements of each of them. Event handlers can added by using <code>.on</code> method of the Dataflow instance - lines 46-48.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> tx <span class="token operator">=</span> vega<span class="token punctuation">.</span>transforms<span class="token punctuation">;</span> <span class="token comment">// all transforms </span>
<span class="token keyword">var</span> out <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#output'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> area <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#text'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
area<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;Despite myriad tools for visualizing data, there remains a gap between the notational efficiency of high-level visualization systems and the expressiveness and accessibility of low-level graphical systems.&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> stopwords <span class="token operator">=</span> <span class="token string">&quot;(i|me|my|myself|we|us|our|ours|ourselves|you|your|yours|yourself|yourselves|he|him|his)&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> get <span class="token operator">=</span> vega<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">readText</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> pulse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> pulse<span class="token punctuation">.</span>rem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">return</span> pulse<span class="token punctuation">.</span>source <span class="token operator">=</span> pulse<span class="token punctuation">.</span>add <span class="token operator">=</span> <span class="token punctuation">[</span>vega<span class="token punctuation">.</span><span class="token function">ingest</span><span class="token punctuation">(</span>area<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">threshold</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> freq <span class="token operator">=</span> _<span class="token punctuation">.</span>freq<span class="token punctuation">,</span>
      <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> t<span class="token punctuation">.</span>count <span class="token operator">&gt;=</span> freq<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span>fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">updatePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  out<span class="token punctuation">.</span>innerText <span class="token operator">=</span> c1<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>count <span class="token operator">-</span> a<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
        <span class="token operator">||</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>text <span class="token operator">&gt;</span> a<span class="token punctuation">.</span>text <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> a<span class="token punctuation">.</span>text <span class="token operator">&gt;</span> b<span class="token punctuation">.</span>text <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> t<span class="token punctuation">.</span>text <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> t<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vega<span class="token punctuation">.</span>Dataflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// create a new Dataflow instance</span>
<span class="token comment">// then add various operators into Dataflow instance:</span>
    ft <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// word frequency threshold</span>
    ff <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>threshold<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">freq</span><span class="token operator">:</span>ft<span class="token punctuation">}</span><span class="token punctuation">)</span>
    rt <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>readText<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// add a transforms (tx):</span>
    cp <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>CountPattern<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">field</span><span class="token operator">:</span>get<span class="token punctuation">,</span> <span class="token keyword">case</span><span class="token operator">:</span><span class="token string">'lower'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pattern</span><span class="token operator">:</span><span class="token string">'[\\w\']{2,}'</span><span class="token punctuation">,</span> <span class="token literal-property property">stopwords</span><span class="token operator">:</span>stopwords<span class="token punctuation">,</span> <span class="token literal-property property">pulse</span><span class="token operator">:</span>rt<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    cc <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">pulse</span><span class="token operator">:</span>cp<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fc <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Filter<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">expr</span><span class="token operator">:</span>ff<span class="token punctuation">,</span> <span class="token literal-property property">pulse</span><span class="token operator">:</span>cc<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    c1 <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">pulse</span><span class="token operator">:</span>fc<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    up <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>updatePage<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">pulse</span><span class="token operator">:</span> c1<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
df<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span>area<span class="token punctuation">,</span> <span class="token string">'keyup'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">debounce</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rt<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span><span class="token string">'#slider'</span><span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ft<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">+</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <blockquote><p>// below is old analysis</p></blockquote> <p>There are number of transforms and they are located in different libraries. Basics are here <a href="https://github.com/vega/vega-dataflow/tree/master/src/transforms" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-dataflow/tree/master/src/transforms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Generally, all data flow happens in the <a href="https://github.com/vega/vega-dataflow" target="_blank" rel="noopener noreferrer">vega-dataflow module<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. There are lots of complicated operations performed to data input and parameters. Some of transform functions are inherited from another functions/classes which makes difficult to separate them:</p> <p>Filter function:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Filter</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Transform</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">fastmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> prototype <span class="token operator">=</span> <span class="token function">inherits</span><span class="token punctuation">(</span>Filter<span class="token punctuation">,</span> Transform<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// more code for prototype</span>
</code></pre></div><p>and Transform is:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Operator <span class="token keyword">from</span> <span class="token string">'./Operator'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>inherits<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vega-util'</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * Abstract class for operators that process data tuples.
 * Subclasses must provide a {@link transform} method for operator processing.
 * @constructor
 * @param {*} [init] - The initial value for this operator.
 * @param {object} [params] - The parameters for this operator.
 * @param {Operator} [source] - The operator from which to receive pulses.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Transform</span><span class="token punctuation">(</span><span class="token parameter">init<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Operator</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> init<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> prototype <span class="token operator">=</span> <span class="token function">inherits</span><span class="token punctuation">(</span>Transform<span class="token punctuation">,</span> Operator<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * Overrides {@link Operator.evaluate} for transform operators.
 * Marshalls parameter values and then invokes {@link transform}.
 * @param {Pulse} pulse - the current dataflow pulse.
 * @return {Pulse} The output pulse (or StopPropagation). A falsy return
     value (including undefined) will let the input pulse pass through.
 */</span>
prototype<span class="token punctuation">.</span><span class="token function-variable function">evaluate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">pulse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">marshall</span><span class="token punctuation">(</span>pulse<span class="token punctuation">.</span>stamp<span class="token punctuation">)</span><span class="token punctuation">,</span>
      out <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> pulse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  params<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> out<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * Process incoming pulses.
 * Subclasses should override this method to implement transforms.
 * @param {Parameters} _ - The operator parameter values.
 * @param {Pulse} pulse - The current dataflow pulse.
 * @return {Pulse} The output pulse (or StopPropagation). A falsy return
 *   value (including undefined) will let the input pulse pass through.
 */</span>
prototype<span class="token punctuation">.</span><span class="token function-variable function">transform</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>and as we can see Transform inherits from Operator and so on.</p> <p>But some of the transform functions looks independent:</p> <p>Getting cross product:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// filter is an optional  function for selectively including tuples in the cross product.</span>
<span class="token keyword">function</span> <span class="token function">cross</span><span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> filter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      n <span class="token operator">=</span> input<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
      i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      j<span class="token punctuation">,</span> left<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> left <span class="token operator">=</span> input<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>n<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      t<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> input<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">ingest</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        t<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> left<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Other transforms:</p> <ul><li>Linkpath <a href="https://github.com/vega/vega-encode" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-encode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Geo <a href="https://github.com/vega/vega-geo" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-geo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Hierarchical <a href="https://github.com/vega/vega-hierarchy/tree/master/definitions" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-hierarchy/tree/master/definitions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>voronoi <a href="https://github.com/vega/vega-voronoi" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-voronoi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>crossfilter <a href="https://github.com/vega/vega-crossfilter" target="_blank" rel="noopener noreferrer">https://github.com/vega/vega-crossfilter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="dp-pipelines-transforms"><a href="#dp-pipelines-transforms" class="header-anchor">#</a> DP Pipelines transforms</h3> <p>DPP provides number of transforms that can be applied to a dataset. However, those transforms cannot be processed inside browsers as the library requires Python scripts to run.</p> <p><strong>Below is a copy-paste from DPP docs:</strong></p> <h4 id="concatenate"><a href="#concatenate" class="header-anchor">#</a> <em><strong><code>concatenate</code></strong></em></h4> <p>Concatenates a number of streamed resources and converts them to a single resource.</p> <p><em>Parameters</em>:</p> <ul><li><p><code>sources</code> - Which resources to concatenate. Same semantics as <code>resources</code> in <code>stream_remote_resources</code>.</p> <p>If omitted, all resources in datapackage are concatenated.</p> <p>Resources to concatenate must appear in consecutive order within the data-package.</p></li> <li><p><code>target</code> - Target resource to hold the concatenated data. Should define at least the following properties:</p> <ul><li><code>name</code> - name of the resource</li> <li><code>path</code> - path in the data-package for this file.</li></ul> <p>If omitted, the target resource will receive the name <code>concat</code> and will be saved at <code>data/concat.csv</code> in the datapackage.</p></li> <li><p><code>fields</code> - Mapping of fields between the sources and the target, so that the keys are the <em>target</em> field names, and values are lists of <em>source</em> field names.</p> <p>This mapping is used to create the target resources schema.</p> <p>Note that the target field name is <em>always</em> assumed to be mapped to itself.</p></li></ul> <p><em>Example</em>:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> concatenate
  <span class="token key atrule">parameters</span><span class="token punctuation">:</span> 
    <span class="token key atrule">target</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> multi<span class="token punctuation">-</span>year<span class="token punctuation">-</span>report
      <span class="token key atrule">path</span><span class="token punctuation">:</span> data/multi<span class="token punctuation">-</span>year<span class="token punctuation">-</span>report.csv
    <span class="token key atrule">sources</span><span class="token punctuation">:</span> <span class="token string">'report-year-20[0-9]{2}'</span>
    <span class="token key atrule">fields</span><span class="token punctuation">:</span>
      <span class="token key atrule">activity</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token key atrule">amount</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'2009_amount'</span><span class="token punctuation">,</span> <span class="token string">'Amount'</span><span class="token punctuation">,</span> <span class="token string">'AMOUNT [USD]'</span><span class="token punctuation">,</span> <span class="token string">'$$$'</span><span class="token punctuation">]</span>    
</code></pre></div><p>In this example we concatenate all resources that look like <code>report-year-&lt;year&gt;</code>, and output them to the <code>multi-year-report</code> resource.</p> <p>The output contains two fields:</p> <ul><li><code>activity</code> , which is called <code>activity</code> in all sources</li> <li><code>amount</code>, which has varying names in different resources (e.g. <code>Amount</code>, <code>2009_amount</code>, <code>amount</code> etc.)</li></ul> <h4 id="join"><a href="#join" class="header-anchor">#</a> <em><strong><code>join</code></strong></em></h4> <p>Joins two streamed resources.</p> <p>“Joining” in our case means taking the <em>target</em> resource, and adding fields to each of its rows by looking up data in the <em>source</em> resource.</p> <p>A special case for the join operation is when there is no target stream, and all unique rows from the source are used to create it.<br>
This mode is called <em>deduplication</em> mode - The target resource will be created and  deduplicated rows from the source will be added to it.</p> <p><em>Parameters</em>:</p> <ul><li><p><code>source</code> - information regarding the <em>source</em> resource</p> <ul><li><code>name</code> - name of the resource</li> <li><code>key</code> - One of
<ul><li>List of field names which should be used as the lookup key</li> <li>String, which would be interpreted as a Python format string used to form the key (e.g. <code>{&lt;field_name_1&gt;}:{field_name_2}</code>)</li></ul></li> <li><code>delete</code> - delete from data-package after joining (<code>False</code> by default)</li></ul></li> <li><p><code>target</code> - Target resource to hold the joined data. Should define at least the following properties:</p> <ul><li><code>name</code> - as in <code>source</code></li> <li><code>key</code> - as in <code>source</code>, or <code>null</code> for creating the target resource and performing <em>deduplication</em>.</li></ul></li> <li><p><code>fields</code> - mapping of fields from the source resource to the target resource.<br>
Keys should be field names in the target resource.<br>
Values can define two attributes:</p> <ul><li><p><code>name</code> - field name in the source (by default is the same as the target field name)</p></li> <li><p><code>aggregate</code> - aggregation strategy (how to handle multiple <em>source</em> rows with the same key). Can take the following options:</p> <ul><li><p><code>sum</code> - summarise aggregated values.<br>
For numeric values it’s the arithmetic sum, for strings the concatenation of strings and for other types will error.</p></li> <li><p><code>avg</code> - calculate the average of aggregated values.</p> <p>For numeric values it’s the arithmetic average and for other types will err.</p></li> <li><p><code>max</code> - calculate the maximum of aggregated values.</p> <p>For numeric values it’s the arithmetic maximum, for strings the dictionary maximum and for other types will error.</p></li> <li><p><code>min</code> - calculate the minimum of aggregated values.</p> <p>For numeric values it’s the arithmetic minimum, for strings the dictionary minimum and for other types will error.</p></li> <li><p><code>first</code> - take the first value encountered</p></li> <li><p><code>last</code> - take the last value encountered</p></li> <li><p><code>count</code> - count the number of occurrences of a specific key<br>
For this method, specifying <code>name</code> is not required. In case it is specified, <code>count</code> will count the number of non-null values for that source field.</p></li> <li><p><code>set</code> - collect all distinct values of the aggregated field, unordered</p></li> <li><p><code>array</code> - collect all values of the aggregated field, in order of appearance</p></li> <li><p><code>any</code> - pick any value.</p></li></ul> <p>By default, <code>aggregate</code> takes the <code>any</code> value.</p></li></ul> <p>If neither <code>name</code> or <code>aggregate</code> need to be specified, the mapping can map to the empty object <code>{}</code> or to <code>null</code>.</p></li> <li><p><code>full</code>  - Boolean,</p> <ul><li>If <code>True</code> (the default), failed lookups in the source will result in “null” values at the source.</li> <li>if <code>False</code>, failed lookups in the source will result in dropping the row from the target.</li></ul></li></ul> <p><em>Important: the “source” resource <strong>must</strong> appear before the “target” resource in the data-package.</em></p> <p><em>Examples</em>:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> join
  <span class="token key atrule">parameters</span><span class="token punctuation">:</span> 
    <span class="token key atrule">source</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> world_population
      <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;country_code&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">delete</span><span class="token punctuation">:</span> yes
    <span class="token key atrule">target</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> country_gdp_2015
      <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;CC&quot;</span><span class="token punctuation">]</span>
    <span class="token key atrule">fields</span><span class="token punctuation">:</span>
      <span class="token key atrule">population</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;census_2015&quot;</span>        
    <span class="token key atrule">full</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>The above example aims to create a package containing the GDP and Population of each country in the world.</p> <p>We have one resource (<code>world_population</code>) with data that looks like:</p> <table><thead><tr><th>country_code</th> <th>country_name</th> <th>census_2000</th> <th>census_2015</th></tr></thead> <tbody><tr><td>UK</td> <td>United Kingdom</td> <td>58857004</td> <td>64715810</td></tr> <tr><td>…</td> <td></td> <td></td> <td></td></tr></tbody></table> <p>And another resource (<code>country_gdp_2015</code>) with data that looks like:</p> <table><thead><tr><th>CC</th> <th>GDP (£m)</th> <th>Net Debt (£m)</th></tr></thead> <tbody><tr><td>UK</td> <td>1832318</td> <td>1606600</td></tr> <tr><td>…</td> <td></td> <td></td></tr></tbody></table> <p>The <code>join</code> command will match rows in both datasets based on the <code>country_code</code> / <code>CC</code> fields, and then copying the value in the <code>census_2015</code> field into a new <code>population</code> field.</p> <p>The resulting data package will have the <code>world_population</code> resource removed and the <code>country_gdp_2015</code> resource looking like:</p> <table><thead><tr><th>CC</th> <th>GDP (£m)</th> <th>Net Debt (£m)</th> <th>population</th></tr></thead> <tbody><tr><td>UK</td> <td>1832318</td> <td>1606600</td> <td>64715810</td></tr> <tr><td>…</td> <td></td> <td></td> <td></td></tr></tbody></table> <p>A more complex example:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> join
  <span class="token key atrule">parameters</span><span class="token punctuation">:</span> 
    <span class="token key atrule">source</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> screen_actor_salaries
      <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">&quot;{production} ({year})&quot;</span>
    <span class="token key atrule">target</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> mgm_movies
      <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">&quot;{title}&quot;</span>
    <span class="token key atrule">fields</span><span class="token punctuation">:</span>
      <span class="token key atrule">num_actors</span><span class="token punctuation">:</span>
        <span class="token key atrule">aggregate</span><span class="token punctuation">:</span> <span class="token string">'count'</span>
      <span class="token key atrule">average_salary</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> salary
        <span class="token key atrule">aggregate</span><span class="token punctuation">:</span> <span class="token string">'avg'</span>
      <span class="token key atrule">total_salaries</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> salary
        <span class="token key atrule">aggregate</span><span class="token punctuation">:</span> <span class="token string">'sum'</span>
    <span class="token key atrule">full</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div><p>This example aims to analyse salaries for screen actors in the MGM studios.</p> <p>Once more, we have one resource (<code>screen_actor_salaries</code>) with data that looks like:</p> <table><thead><tr><th>year</th> <th>production</th> <th>actor</th> <th>salary</th></tr></thead> <tbody><tr><td>2016</td> <td>Vertigo 2</td> <td>Mr. T</td> <td>15000000</td></tr> <tr><td>2016</td> <td>Vertigo 2</td> <td>Robert Downey Jr.</td> <td>7000000</td></tr> <tr><td>2015</td> <td>The Fall - Resurrection</td> <td>Jeniffer Lawrence</td> <td>18000000</td></tr> <tr><td>2015</td> <td>Alf - The Return to Melmack</td> <td>The Rock</td> <td>12000000</td></tr> <tr><td>…</td> <td></td> <td></td> <td></td></tr></tbody></table> <p>And another resource (<code>mgm_movies</code>) with data that looks like:</p> <table><thead><tr><th>title</th> <th>director</th> <th>producer</th></tr></thead> <tbody><tr><td>Vertigo 2 (2016)</td> <td>Lindsay Lohan</td> <td>Lee Ka Shing</td></tr> <tr><td>iRobot - The Movie (2018)</td> <td>Mr. T</td> <td>Mr. T</td></tr> <tr><td>…</td> <td></td> <td></td></tr></tbody></table> <p>The <code>join</code> command will match rows in both datasets based on the movie name and production year. Notice how we overcome incompatible fields by using different key patterns.</p> <p>The resulting dataset could look like:</p> <table><thead><tr><th>title</th> <th>director</th> <th>producer</th> <th>num_actors</th> <th>average_salary</th> <th>total_salaries</th></tr></thead> <tbody><tr><td>Vertigo 2 (2016)</td> <td>Lindsay Lohan</td> <td>Lee Ka Shing</td> <td>2</td> <td>11000000</td> <td>22000000</td></tr> <tr><td>…</td> <td></td> <td></td> <td></td> <td></td> <td></td></tr></tbody></table> <hr> <h3 id="vega-dataflow-usage-for-dp-views"><a href="#vega-dataflow-usage-for-dp-views" class="header-anchor">#</a> Vega Dataflow usage for DP views</h3> <p>Vega has quite a lot of data transform functions available, however, most of them require complicated JSON descriptor to use. Although we may implement them in the future, at the moment we could start with the most basic and essential ones:</p> <p><strong>List of transforms that we could use:</strong></p> <ul><li>Aggregate</li> <li>Filter</li> <li>Formula (applies given formula to dataset)</li> <li>Sample</li></ul> <h4 id="aggregate-example"><a href="#aggregate-example" class="header-anchor">#</a> Aggregate example</h4> <p>We have dataset with 4 fields - a, b, c and d. Lets apply different aggregation methods on them - count, sum, min and max:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> vegadataflow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/vega-dataflow.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> tx <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>transforms<span class="token punctuation">,</span>
    changeset <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>changeset<span class="token punctuation">;</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.76</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.14</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">17.05</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.79</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">21.29</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.92</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.33</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">22.9</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.52</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">21.12</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.15</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.72</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.04</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.31</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.93</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">18.09</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">16.99</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.01</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    b <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    c <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    d <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vegadataflow<span class="token punctuation">.</span>Dataflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">)</span><span class="token punctuation">,</span>
    agg <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Aggregate<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">ops</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">pulse</span><span class="token operator">:</span> col
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    out <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">pulse</span><span class="token operator">:</span> agg<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
df<span class="token punctuation">.</span><span class="token function">pulse</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token function">changeset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Output:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span> 
  <span class="token punctuation">{</span>
    <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">count_a</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">sum_b</span><span class="token operator">:</span> <span class="token number">103.14</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">min_c</span><span class="token operator">:</span> <span class="token number">16.99</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">max_d</span><span class="token operator">:</span> <span class="token number">21.12</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="filter-example"><a href="#filter-example" class="header-anchor">#</a> Filter example</h4> <p>Using the dataset from example above, lets filter values of field <code>a</code> that are not greater than 19:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> vegadataflow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/vega-dataflow.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> tx <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>transforms<span class="token punctuation">,</span>
    changeset <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>changeset<span class="token punctuation">;</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.76</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.14</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">17.05</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.79</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">21.29</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.92</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.33</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">22.9</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.52</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">21.12</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.15</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.72</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.04</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.31</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.93</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">18.09</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">16.99</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.01</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> filter1 <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">accessor</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> d<span class="token punctuation">.</span>a <span class="token operator">&gt;</span> <span class="token number">19</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vegadataflow<span class="token punctuation">.</span>Dataflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ex <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">)</span><span class="token punctuation">,</span>
    fil <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Filter<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">expr</span><span class="token operator">:</span> ex<span class="token punctuation">,</span> <span class="token literal-property property">pulse</span><span class="token operator">:</span> col<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    out <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">pulse</span><span class="token operator">:</span> fil<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
df<span class="token punctuation">.</span><span class="token function">pulse</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token function">changeset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
df<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> filter1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Output:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span> 
  <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">21.29</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span> <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token number">19.92</span><span class="token punctuation">,</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">20.33</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">22.9</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">19.52</span><span class="token punctuation">,</span> <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token number">21.12</span><span class="token punctuation">,</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">20.15</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">20.72</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">19.04</span><span class="token punctuation">,</span> <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token number">19.31</span><span class="token punctuation">,</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span> 
<span class="token punctuation">]</span>
</code></pre></div><h4 id="formula-example"><a href="#formula-example" class="header-anchor">#</a> Formula example</h4> <p>Using the same dataset, lets apply mapping on a field:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> vegadataflow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/vega-dataflow.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> tx <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>transforms<span class="token punctuation">,</span>
    changeset <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>changeset<span class="token punctuation">;</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.76</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.14</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">17.05</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.79</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">21.29</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.19</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.92</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.33</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">22.9</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.52</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">21.12</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">20.15</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">20.72</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">19.04</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">19.31</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{</span>
   <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> <span class="token number">17.93</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;b&quot;</span><span class="token operator">:</span> <span class="token number">18.09</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;c&quot;</span><span class="token operator">:</span> <span class="token number">16.99</span><span class="token punctuation">,</span>
   <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> <span class="token number">17.01</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vegadataflow<span class="token punctuation">.</span>Dataflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    e <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    f <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    formula1 <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">accessor</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> d<span class="token punctuation">.</span>a <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    formula2 <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span><span class="token function">accessor</span><span class="token punctuation">(</span><span class="token parameter">d</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> d<span class="token punctuation">.</span>b <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    col <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Collect<span class="token punctuation">)</span><span class="token punctuation">,</span>
    fa <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Formula<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">expr</span><span class="token operator">:</span> formula1<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token literal-property property">pulse</span><span class="token operator">:</span> col<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    fb <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Formula<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">expr</span><span class="token operator">:</span> formula2<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token literal-property property">pulse</span><span class="token operator">:</span> fa<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
df<span class="token punctuation">.</span><span class="token function">pulse</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token function">changeset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>col<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Output:</p> <div class="language- extra-class"><pre class="language-text"><code>[ 177.60000000000002, 191.9, 203.29999999999998, 201.5, 179.3 ]
[ 2.0140000000000002, 2.129, 2.29, 2.072, 1.809 ]
</code></pre></div><h4 id="sample-example"><a href="#sample-example" class="header-anchor">#</a> Sample example</h4> <p>Lets create a dataset with 100 rows and take a sample of 10 from it:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> vegadataflow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./build/vega-dataflow.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> tx <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>transforms<span class="token punctuation">,</span>
    changeset <span class="token operator">=</span> vegadataflow<span class="token punctuation">.</span>changeset<span class="token punctuation">;</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
    sampleSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
    data <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span>
    i<span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">v</span><span class="token operator">:</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vegadataflow<span class="token punctuation">.</span>Dataflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    s <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>Sample<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">size</span><span class="token operator">:</span> sampleSize<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
df<span class="token punctuation">.</span><span class="token function">pulse</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token function">changeset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Output:</p> <div class="language- extra-class"><pre class="language-text"><code>[ 
  { v: 0.3332451883830292, _id: 69 },
  { v: 0.2874480689159735, _id: 3 },
  { v: 0.18009915754527817, _id: 41 },
  { v: 0.10513776386462825, _id: 27 },
  { v: 0.4972760501252764, _id: 35 },
  { v: 0.757859721485594, _id: 67 },
  { v: 0.248170225498199, _id: 64 },
  { v: 0.431513510601889, _id: 28 },
  { v: 0.07281378713091247, _id: 37 },
  { v: 0.9543216903991236, _id: 33 } 
]
</code></pre></div><h3 id="suggestion-on-usage-from-datapackage-json"><a href="#suggestion-on-usage-from-datapackage-json" class="header-anchor">#</a> Suggestion on usage from datapackage.json</h3> <p>Our current simple view layout:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sample'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resource</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">specType</span><span class="token operator">:</span> <span class="token string">'simple'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">spec</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'line'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">series</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We could add <code>transform</code> property that would be a specification for transforms to be applied. Each transform would have slightly different properties:</p> <h4 id="aggregate"><a href="#aggregate" class="header-anchor">#</a> Aggregate</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'aggregate'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">operations</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For <code>aggregate</code> transform, a publisher should pass a field name and an operation to be applied. Operations should be one of <a href="https://vega.github.io/vega/docs/transforms/aggregate/" target="_blank" rel="noopener noreferrer">https://vega.github.io/vega/docs/transforms/aggregate/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="filter"><a href="#filter" class="header-anchor">#</a> Filter</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'filter'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">expr</span><span class="token operator">:</span> <span class="token string">'data.fieldName &gt; 10'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For <code>filter</code> type expression should evaluate to true or false so only truthy values will be kept.</p> <h4 id="formula"><a href="#formula" class="header-anchor">#</a> Formula</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'formula'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">expr</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'data.fieldName * 2'</span><span class="token punctuation">,</span> <span class="token string">'data.fieldName + 10'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">as</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For <code>formula</code> type, a field will be mapped with given expression and output will be stored in new fields that are specified in <code>as</code> property.</p> <h4 id="sample"><a href="#sample" class="header-anchor">#</a> Sample</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token operator">...</span>
  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'sample'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token string">'some integer'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
</code></pre></div><p>In <code>sample</code> type, only size of a sample is needed.</p> <h2 id="appendix-sql-transforms"><a href="#appendix-sql-transforms" class="header-anchor">#</a> Appendix: SQL Transforms</h2> <p>Just use SQL e.g.</p> <ul><li><a href="http://harelba.github.io/q/" target="_blank" rel="noopener noreferrer">http://harelba.github.io/q/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/agershun/alasql" target="_blank" rel="noopener noreferrer">https://github.com/agershun/alasql<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/google/lovefield" target="_blank" rel="noopener noreferrer">https://github.com/google/lovefield<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="text-xl mt-10"><a href="/blog/">Blog Index</a></footer></div></main></div> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a2902b81.js" defer></script><script src="/assets/js/3.5fa550ec.js" defer></script><script src="/assets/js/2.17b1c5c9.js" defer></script><script src="/assets/js/65.071f1fe3.js" defer></script>
  </body>
</html>
